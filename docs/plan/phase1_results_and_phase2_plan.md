# Phase 1 결과 보고 및 Phase 2 계획

---

## Phase 1 결과

### 목표

Vanilla HTML/CSS/JS 프로젝트를 Svelte + TypeScript + PixiJS + Vite 기반으로 리팩토링하고, 확장 가능한 파티클 엔진을 구현한다.

### 달성 현황

| 마일스톤 | 기간 | 상태 |
|---|---|---|
| M1. 프로젝트 초기화 | — | ✅ 완료 |
| M2. 코어 엔진 구현 | — | ✅ 완료 |
| M3. 현재 기능 마이그레이션 | — | ✅ 완료 |
| M4. 프리셋 확장 및 UI 개선 | — | ✅ 완료 |
| M5. 마무리 및 배포 | — | ✅ 완료 |

### 구현된 아키텍처

```
ParticleSystem (순수 TypeScript, 프레임워크 무관)
├── Emitter (설정 기반 파티클 생성 + 오브젝트 풀링)
│   └── Particle[] (위치, 속도, 크기, 수명, 색상, 회전, 투명도)
├── Force[]
│   ├── GravityForce (일정 방향 가속)
│   ├── WindForce (바람, 시간 변화 가능)
│   ├── TurbulenceForce (다층 사인파 기반 불규칙 흔들림)
│   ├── AttractForce (특정 좌표 인력)
│   └── RepelForce (특정 좌표 척력, 마우스 인터랙션에 사용)
└── update(dt) → PixiRenderer.sync() → WebGL 렌더링
```

### 구현된 기능

#### 이펙트 프리셋 (4종)

| 프리셋 | 색상 | 파티클 수 | 물리 특성 |
|---|---|---|---|
| ❄️ 눈 | 흰색 | 800 | 중력 + 난류, 느린 낙하 |
| 🌧️ 비 | 파란색 | 2000 | 강한 중력 + 바람, 빠른 직선 낙하 |
| 🌸 벚꽃 | 분홍색 | 300 | 약한 중력 + 바람 + 난류, 부드러운 부유 |
| 🍂 낙엽 | 주황색 | 200 | 중력 + 강한 바람 + 강한 난류, 불규칙 흔들림 |

#### 컨트롤 패널

- 프리셋 선택 (2×2 버튼 그리드)
- 파티클 수 (50~3000), 생성 속도 (5~200/s)
- 크기 범위 (최소/최대), 투명도
- 낙하 속도, 속도 다양성
- 파티클 색상 (컬러 피커)
- 배경 설정 (단색 배경, 이미지 배경)
- 커스텀 이미지 파티클 업로드
- 패널 슬라이딩 열기/닫기
- 바로 적용 / 모두 제거 버튼

#### 인터랙션

- 마우스 커서 근처 파티클 밀어내기 (반경 100px, RepelForce)

### 기술 스택

| 레이어 | 기술 | 역할 |
|---|---|---|
| 렌더링 | PixiJS 8 | WebGL 2D 가속 렌더링 |
| UI | Svelte 5 | 반응형 컴포넌트 + 상태 관리 |
| 언어 | TypeScript | 타입 안전성 |
| 빌드 | Vite 7 | HMR 개발 서버, 트리셰이킹 |
| 린트 | ESLint + Prettier | 코드 품질 |
| 배포 | GitHub Actions → GitHub Pages | 자동 배포 |

### 빌드 결과

- 총 번들 크기: ~280KB (gzipped ~90KB)
- 빌드 시간: ~4초
- 린트 에러: 0

### 성능

- 3,000 파티클: VM 환경에서 21~30fps 안정 동작
- GPU 메모리: 2.1MB (매우 낮음)
- 향후 최적화 여지: `Graphics` → `Sprite` + `ParticleContainer` 전환 시 10만+ 파티클 가능

### 디렉토리 구조 (최종)

```
src/
├── lib/
│   ├── engine/                  # 코어 파티클 엔진 (순수 TS)
│   │   ├── Particle.ts
│   │   ├── Emitter.ts
│   │   ├── ParticleSystem.ts
│   │   ├── types.ts
│   │   └── physics/
│   │       ├── Vector2.ts
│   │       └── Forces.ts
│   ├── renderer/
│   │   └── PixiRenderer.ts
│   └── presets/
│       ├── snow.ts / rain.ts / sakura.ts / leaves.ts
│       └── index.ts
├── components/
│   ├── Canvas.svelte
│   ├── ControlPanel.svelte
│   ├── controls/
│   │   ├── SliderControl.svelte
│   │   ├── ColorPicker.svelte
│   │   ├── ImageUploader.svelte
│   │   └── PresetSelector.svelte
│   └── layout/
│       └── SidePanel.svelte
├── stores/
│   ├── particleConfig.ts
│   └── appState.ts
├── App.svelte
├── main.ts
└── app.css
```

---

## Phase 2 계획

Phase 2의 목표는 프로젝트 A(ForFun Visual Studio)에 **두 가지 모드**를 추가하는 것이다.

### 목표

Phase 1에서 완성된 코어 엔진 위에 두 가지 활용 모드를 구현하여, 단순한 "이펙트 뷰어"에서 **도구**로 격상시킨다.

### 두 가지 모드

#### Ambient Mode (분위기 연출 모드)

실시간 데이터와 연동하여 배경 분위기를 자동으로 연출하는 모드.

**핵심 기능:**

- **날씨 API 연동**: OpenWeatherMap 등에서 현재 날씨를 가져와 자동으로 프리셋 전환 (비 오면 비 프리셋, 눈 오면 눈 프리셋)
- **시간대 반영**: 시간에 따라 배경색 자동 변경 (낮 → 밝은 하늘, 밤 → 어두운 배경)
- **음악 비주얼라이저**: Web Audio API로 마이크/오디오 입력을 분석하여 BPM에 따라 파티클 속도/밀도 변화
- **자동 프리셋 순환**: 일정 간격으로 프리셋이 부드럽게 전환 (크로스페이드)
- **전체화면 모드**: 카페/매장 디스플레이용 전체화면 뷰

**구현 우선순위:**

1. 시간대 기반 배경색 자동 변경
2. 자동 프리셋 순환 (크로스페이드 전환)
3. 전체화면 모드
4. 날씨 API 연동
5. 음악 비주얼라이저 (Web Audio API)

#### Create Mode (창작 모드)

사용자가 만든 장면을 저장/내보내는 도구 모드.

**핵심 기능:**

- **장면 저장/불러오기**: 현재 설정(프리셋, 파라미터, 배경)을 JSON으로 저장하고 불러오기
- **URL 공유**: 파라미터를 URL 쿼리스트링으로 인코딩하여 "이 장면을 공유" 링크 생성
- **스크린샷 내보내기**: 현재 화면을 PNG로 캡처하여 다운로드
- **GIF/영상 녹화**: Canvas 녹화 → WebM/GIF 내보내기
- **멀티 레이어**: 여러 이펙트를 동시에 겹쳐서 깊이감 표현 (예: 전경 벚꽃 + 후경 눈)
- **커스텀 프리셋 저장**: 사용자가 조정한 파라미터를 이름 붙여 저장

**구현 우선순위:**

1. 장면 저장/불러오기 (JSON export/import)
2. URL 쿼리스트링 공유
3. 스크린샷 PNG 내보내기
4. 멀티 레이어 (2~3개 이펙트 동시 렌더링)
5. 커스텀 프리셋 저장 (localStorage)
6. GIF/영상 녹화

### UI 구조 변경

현재 단일 패널 → **모드 탭** 추가:

```
┌──────────────────────┐
│  [Ambient] [Create]  │  ← 모드 탭 (상단)
├──────────────────────┤
│  이펙트 선택          │  ← 공통 영역
│  ❄️ 🌧️ 🌸 🍂         │
├──────────────────────┤
│                      │
│  (모드별 컨트롤)      │  ← Ambient: 자동 설정
│                      │      Create: 저장/내보내기
│                      │
├──────────────────────┤
│  파티클 설정          │  ← 공통 영역 (기존 슬라이더)
│  배경 설정            │
│  [적용] [제거]        │
└──────────────────────┘
```

### 성능 최적화 (Phase 2 선행 작업)

멀티 레이어 도입 전에 렌더러 최적화가 필요:

- `Graphics` → `Sprite` + `ParticleContainer` 전환
- 파티클 텍스처 아틀라스 생성
- 목표: 10,000+ 파티클에서 60fps

### 예상 마일스톤

| 마일스톤 | 내용 | 예상 기간 |
|---|---|---|
| P2-M1 | 렌더러 최적화 (ParticleContainer) | 2~3일 |
| P2-M2 | 모드 탭 UI + 라우팅 구조 | 1~2일 |
| P2-M3 | Create Mode — 장면 저장/불러오기, URL 공유 | 2~3일 |
| P2-M4 | Create Mode — 스크린샷, 멀티 레이어 | 3~4일 |
| P2-M5 | Ambient Mode — 시간대, 자동 순환, 전체화면 | 2~3일 |
| P2-M6 | Ambient Mode — 날씨 API, 음악 비주얼라이저 | 3~4일 |
| P2-M7 | 마무리 및 배포 | 1~2일 |
| **합계** | | **14~21일** |

### Phase 2 완료 시점의 결과물

- Ambient Mode: 시간/날씨/음악에 반응하는 자동 분위기 연출 도구
- Create Mode: 장면 저장, URL 공유, 스크린샷, 멀티 레이어 지원
- 렌더러 최적화로 10,000+ 파티클 60fps 달성
- Phase 1의 모든 기능은 기본 모드로 유지
